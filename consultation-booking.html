<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Consultation - JusticeSetu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* CSS Variables for consistent theming */
        :root {
            --navy-blue: #1a237e;
            --navy-blue-light: #283593;
            --gold: #ffb300;
            --gold-light: #ffca28;
            --white: #ffffff;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --dark-gray: #424242;
            --error: #d32f2f;
            --success: #388e3c;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }

        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            border: none;
            font-size: 0.95rem;
        }

        .btn-primary {
            background-color: var(--gold);
            color: var(--navy-blue);
        }

        .btn-primary:hover {
            background-color: var(--gold-light);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--navy-blue);
            color: var(--white);
        }

        .btn-secondary:hover {
            background-color: var(--navy-blue-light);
            transform: translateY(-2px);
        }

        .btn-outline {
            border: 2px solid var(--navy-blue);
            color: var(--navy-blue);
            background-color: transparent;
        }

        .btn-outline:hover {
            background-color: var(--navy-blue);
            color: var(--white);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-full {
            width: 100%;
        }

        .btn-icon {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        /* Header Styles */
        header {
            background-color: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--navy-blue);
        }

        .logo i {
            margin-right: 10px;
            color: var(--gold);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--navy-blue);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-name {
            font-weight: 500;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--navy-blue);
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .logout-btn:hover {
            color: var(--gold);
        }

        /* Dashboard Layout */
        .dashboard {
            display: flex;
            flex: 1;
        }

        .sidebar {
            width: 250px;
            background-color: var(--navy-blue);
            color: var(--white);
            padding: 20px 0;
            height: calc(100vh - 70px);
            position: sticky;
            top: 70px;
            overflow-y: auto;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--white);
            border-left: 4px solid var(--gold);
        }

        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            padding: 30px;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 30px;
        }

        .page-header h1 {
            color: var(--navy-blue);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .page-header p {
            color: var(--dark-gray);
            max-width: 600px;
        }

        /* Booking Layout */
        .booking-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        /* Booking Form */
        .booking-form-section {
            margin-bottom: 30px;
        }

        .booking-card {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--navy-blue);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--navy-blue);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .mode-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .mode-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            border: 2px solid var(--medium-gray);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .mode-option:hover {
            border-color: var(--navy-blue);
            background-color: rgba(26, 35, 126, 0.05);
        }

        .mode-option.selected {
            border-color: var(--gold);
            background-color: rgba(255, 179, 0, 0.1);
        }

        .mode-icon {
            font-size: 2rem;
            color: var(--navy-blue);
            margin-bottom: 10px;
        }

        .mode-option.selected .mode-icon {
            color: var(--gold);
        }

        .mode-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .mode-description {
            font-size: 0.85rem;
            color: var(--dark-gray);
        }

        /* Time Slots */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .time-slot {
            padding: 10px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .time-slot:hover {
            border-color: var(--navy-blue);
            background-color: rgba(26, 35, 126, 0.05);
        }

        .time-slot.selected {
            border-color: var(--gold);
            background-color: rgba(255, 179, 0, 0.1);
            color: var(--navy-blue);
            font-weight: 500;
        }

        .time-slot.unavailable {
            background-color: var(--light-gray);
            color: var(--medium-gray);
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* Lawyer Selection */
        .lawyer-selection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .lawyer-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid var(--medium-gray);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
        }

        .lawyer-option:hover {
            border-color: var(--navy-blue);
            background-color: rgba(26, 35, 126, 0.05);
        }

        .lawyer-option.selected {
            border-color: var(--gold);
            background-color: rgba(255, 179, 0, 0.1);
        }

        .lawyer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--navy-blue);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .lawyer-info {
            flex: 1;
        }

        .lawyer-name {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .lawyer-specialization {
            font-size: 0.85rem;
            color: var(--dark-gray);
        }

        /* Booking Summary */
        .booking-summary-section {
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .summary-card {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .summary-header {
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .summary-header h3 {
            color: var(--navy-blue);
            font-size: 1.4rem;
        }

        .summary-details {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--light-gray);
        }

        .summary-label {
            font-weight: 500;
            color: var(--dark-gray);
        }

        .summary-value {
            color: var(--navy-blue);
            text-align: right;
        }

        .summary-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--navy-blue);
            text-align: center;
            margin: 10px 0;
        }

        .summary-note {
            font-size: 0.85rem;
            color: var(--dark-gray);
            text-align: center;
            margin-top: 10px;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--navy-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success Message */
        .success-message {
            color: var(--success);
            background-color: rgba(56, 142, 60, 0.1);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: none;
            text-align: center;
        }

        /* Error Message */
        .error-message {
            color: var(--error);
            background-color: rgba(211, 47, 47, 0.1);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: none;
        }

        /* Footer */
        footer {
            background-color: var(--navy-blue);
            color: var(--white);
            padding: 30px 0 20px;
            margin-top: auto;
        }

        .footer-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-column h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 2px;
            background-color: var(--gold);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 8px;
        }

        .footer-column ul li a {
            color: rgba(255, 255, 255, 0.8);
            transition: color 0.3s;
        }

        .footer-column ul li a:hover {
            color: var(--gold);
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.7;
            font-size: 0.9rem;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .booking-layout {
                grid-template-columns: 1fr;
            }
            
            .booking-summary-section {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: static;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
            }
            
            .sidebar-menu li {
                flex: 0 0 auto;
                margin-bottom: 0;
            }
            
            .sidebar-menu a {
                padding: 10px 15px;
                white-space: nowrap;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .mode-selection {
                grid-template-columns: 1fr;
            }
            
            .lawyer-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="index.html" class="logo">
                <i class="fas fa-balance-scale"></i>
                JusticeSetu
            </a>
            
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-name" id="userName">User</div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Dashboard Layout -->
    <div class="dashboard">
        <!-- Sidebar -->
        <nav class="sidebar">
            <ul class="sidebar-menu">
                <li><a href="citizen-dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="ai-legal-assistant.html"><i class="fas fa-robot"></i> AI Legal Assistant</a></li>
                <li><a href="case-tracking.html"><i class="fas fa-search"></i> Track Case</a></li>
                <li><a href="find-lawyer.html"><i class="fas fa-user-tie"></i> Find Lawyer</a></li>
                <li><a href="document-locker.html"><i class="fas fa-file-contract"></i> Document Locker</a></li>
                <li><a href="#" class="active"><i class="fas fa-calendar-check"></i> Book Consultation</a></li>
                <li><a href="knowledge-hub.html"><i class="fas fa-book"></i> Legal Knowledge</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <h1>Book a Legal Consultation</h1>
                <p>Schedule a consultation with a verified legal expert to discuss your legal matters</p>
            </div>

            <!-- Success Message -->
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i> 
                <span id="successText">Consultation booked successfully! You will receive a confirmation email shortly.</span>
            </div>

            <!-- Error Message -->
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i> 
                <span id="errorText">Please fill in all required fields to book your consultation.</span>
            </div>

            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <p>Processing your booking...</p>
            </div>

            <!-- Booking Layout -->
            <div class="booking-layout">
                <!-- Booking Form -->
                <section class="booking-form-section">
                    <div class="card booking-card">
                        <h2>Consultation Details</h2>
                        
                        <form id="bookingForm">
                            <!-- Lawyer Selection -->
                            <div class="form-group">
                                <label class="form-label">Select Lawyer *</label>
                                <div class="lawyer-selection" id="lawyerSelection">
                                    <!-- Lawyers will be populated here -->
                                </div>
                                <div class="loading-spinner" id="lawyersLoading">
                                    <div class="spinner"></div>
                                    <p>Loading available lawyers...</p>
                                </div>
                            </div>

                            <!-- Date Selection -->
                            <div class="form-group">
                                <label for="consultationDate" class="form-label">Select Date *</label>
                                <input type="date" id="consultationDate" class="form-input" min="" required>
                            </div>

                            <!-- Time Selection -->
                            <div class="form-group">
                                <label class="form-label">Select Time Slot *</label>
                                <div class="time-slots" id="timeSlots">
                                    <!-- Time slots will be populated here -->
                                </div>
                            </div>

                            <!-- Consultation Mode -->
                            <div class="form-group">
                                <label class="form-label">Consultation Mode *</label>
                                <div class="mode-selection">
                                    <div class="mode-option" data-mode="chat">
                                        <div class="mode-icon">
                                            <i class="fas fa-comments"></i>
                                        </div>
                                        <div class="mode-name">Chat Consultation</div>
                                        <div class="mode-description">Text-based chat with your lawyer</div>
                                    </div>
                                    <div class="mode-option" data-mode="video">
                                        <div class="mode-icon">
                                            <i class="fas fa-video"></i>
                                        </div>
                                        <div class="mode-name">Video Consultation</div>
                                        <div class="mode-description">Face-to-face video call</div>
                                    </div>
                                </div>
                                <input type="hidden" id="consultationMode" required>
                            </div>

                            <!-- Legal Issue Description -->
                            <div class="form-group">
                                <label for="issueDescription" class="form-label">Describe Your Legal Issue</label>
                                <textarea id="issueDescription" class="form-textarea" placeholder="Briefly describe the legal matter you want to discuss..."></textarea>
                            </div>

                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-primary btn-full btn-icon">
                                <i class="fas fa-calendar-check"></i> Book Consultation
                            </button>
                        </form>
                    </div>
                </section>

                <!-- Booking Summary -->
                <section class="booking-summary-section">
                    <div class="card summary-card">
                        <div class="summary-header">
                            <h3>Booking Summary</h3>
                        </div>
                        
                        <div class="summary-details">
                            <div class="summary-item">
                                <span class="summary-label">Lawyer:</span>
                                <span class="summary-value" id="summaryLawyer">Not selected</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Date:</span>
                                <span class="summary-value" id="summaryDate">Not selected</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Time:</span>
                                <span class="summary-value" id="summaryTime">Not selected</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Mode:</span>
                                <span class="summary-value" id="summaryMode">Not selected</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Duration:</span>
                                <span class="summary-value">30 minutes</span>
                            </div>
                        </div>

                        <div class="summary-price" id="summaryPrice">₹ 0</div>

                        <div class="summary-note">
                            <p><i class="fas fa-info-circle"></i> You can cancel or reschedule up to 24 hours before your consultation.</p>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-container">
                <div class="footer-column">
                    <h3>JusticeSetu</h3>
                    <p>Making legal assistance accessible, understandable, and affordable for everyone through technology.</p>
                </div>
                
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="ai-legal-assistant.html">AI Legal Assistant</a></li>
                        <li><a href="find-lawyer.html">Find a Lawyer</a></li>
                        <li><a href="consultation-booking.html">Book Consultation</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 JusticeSetu. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://nbomdnnaigiamjmdvpon.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ib21kbm5haWdpYW1qbWR2cG9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4MzY1NTksImV4cCI6MjA3NzQxMjU1OX0.xmsxZDfw23xC2a98hvIuB0uSjDzg6bivfjNK_KActyE';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // DOM Elements
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const logoutBtn = document.getElementById('logoutBtn');
        const bookingForm = document.getElementById('bookingForm');
        const lawyerSelection = document.getElementById('lawyerSelection');
        const lawyersLoading = document.getElementById('lawyersLoading');
        const consultationDate = document.getElementById('consultationDate');
        const timeSlots = document.getElementById('timeSlots');
        const consultationMode = document.getElementById('consultationMode');
        const issueDescription = document.getElementById('issueDescription');
        const successMessage = document.getElementById('successMessage');
        const successText = document.getElementById('successText');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        
        // Summary elements
        const summaryLawyer = document.getElementById('summaryLawyer');
        const summaryDate = document.getElementById('summaryDate');
        const summaryTime = document.getElementById('summaryTime');
        const summaryMode = document.getElementById('summaryMode');
        const summaryPrice = document.getElementById('summaryPrice');

        // Current user data and booking state
        let currentUser = null;
        let availableLawyers = [];
        let selectedLawyer = null;
        let selectedDate = null;
        let selectedTime = null;
        let selectedMode = null;

        // Consultation pricing
        const consultationPrices = {
            chat: 500,
            video: 1000
        };

        // Time slots for consultations
        const availableTimeSlots = [
            '09:00 AM', '09:30 AM', '10:00 AM', '10:30 AM',
            '11:00 AM', '11:30 AM', '12:00 PM', '12:30 PM',
            '02:00 PM', '02:30 PM', '03:00 PM', '03:30 PM',
            '04:00 PM', '04:30 PM', '05:00 PM', '05:30 PM'
        ];

        // Check authentication and load user data
        async function initializeBooking() {
            const { data: { session }, error } = await supabase.auth.getSession();
            
            if (!session) {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
                return;
            }
            
            currentUser = session.user;
            
            // Load user data
            await loadUserData();
            
            // Load available lawyers
            await loadLawyers();
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            consultationDate.min = today;
            
            // Initialize event listeners
            initializeEventListeners();
        }

        // Load user data from database
        async function loadUserData() {
            const { data, error } = await supabase
                .from('users')
                .select('*')
                .eq('id', currentUser.id)
                .single();
            
            if (error) {
                console.error('Error loading user data:', error);
                return;
            }
            
            if (data) {
                // Update UI with user data
                userName.textContent = data.full_name || 'User';
                
                // Set avatar with first letter of name
                if (data.full_name) {
                    userAvatar.textContent = data.full_name.charAt(0).toUpperCase();
                }
            }
        }

        // Load available lawyers from database
        async function loadLawyers() {
            lawyersLoading.style.display = 'block';
            
            try {
                // Get lawyer profiles with user data
                const { data, error } = await supabase
                    .from('lawyer_profiles')
                    .select(`
                        *,
                        users!inner (
                            full_name,
                            email,
                            phone
                        )
                    `)
                    .eq('verified', true);
                
                if (error) {
                    throw error;
                }
                
                // Store lawyers and display them
                availableLawyers = data || [];
                
                // If no lawyers found, create mock data
                if (availableLawyers.length === 0) {
                    availableLawyers = createMockLawyers();
                }
                
                // Display lawyers
                displayLawyers();
                
            } catch (error) {
                console.error('Error loading lawyers:', error);
                // Create mock data for demonstration
                availableLawyers = createMockLawyers();
                displayLawyers();
            } finally {
                lawyersLoading.style.display = 'none';
            }
        }

        // Create mock lawyers for demonstration
        function createMockLawyers() {
            return [
                {
                    id: '1',
                    specialization: 'Criminal Law',
                    experience_years: 12,
                    location: 'Delhi',
                    languages: ['English', 'Hindi'],
                    rating: 4.8,
                    verified: true,
                    consultation_fee_chat: 500,
                    consultation_fee_video: 1000,
                    users: {
                        full_name: 'Adv. Priya Sharma',
                        email: 'priya.sharma@example.com',
                        phone: '+91 98765 43210'
                    }
                },
                {
                    id: '2',
                    specialization: 'Corporate Law',
                    experience_years: 8,
                    location: 'Mumbai',
                    languages: ['English', 'Marathi'],
                    rating: 4.6,
                    verified: true,
                    consultation_fee_chat: 600,
                    consultation_fee_video: 1200,
                    users: {
                        full_name: 'Adv. Rajesh Kumar',
                        email: 'rajesh.kumar@example.com',
                        phone: '+91 98765 43211'
                    }
                },
                {
                    id: '3',
                    specialization: 'Family Law',
                    experience_years: 15,
                    location: 'Bangalore',
                    languages: ['English', 'Kannada'],
                    rating: 4.9,
                    verified: true,
                    consultation_fee_chat: 700,
                    consultation_fee_video: 1400,
                    users: {
                        full_name: 'Adv. Anita Reddy',
                        email: 'anita.reddy@example.com',
                        phone: '+91 98765 43212'
                    }
                },
                {
                    id: '4',
                    specialization: 'Property Law',
                    experience_years: 10,
                    location: 'Chennai',
                    languages: ['English', 'Tamil'],
                    rating: 4.7,
                    verified: true,
                    consultation_fee_chat: 550,
                    consultation_fee_video: 1100,
                    users: {
                        full_name: 'Adv. Vikram Singh',
                        email: 'vikram.singh@example.com',
                        phone: '+91 98765 43213'
                    }
                }
            ];
        }

        // Display available lawyers
        function displayLawyers() {
            lawyerSelection.innerHTML = '';
            
            availableLawyers.forEach(lawyer => {
                const lawyerOption = document.createElement('div');
                lawyerOption.className = 'lawyer-option';
                lawyerOption.setAttribute('data-lawyer-id', lawyer.id);
                
                lawyerOption.innerHTML = `
                    <div class="lawyer-avatar">${lawyer.users.full_name.charAt(0)}</div>
                    <div class="lawyer-info">
                        <div class="lawyer-name">${lawyer.users.full_name}</div>
                        <div class="lawyer-specialization">${lawyer.specialization}</div>
                        <div class="lawyer-meta">
                            <small>${lawyer.experience_years} years exp • ${lawyer.rating} ★</small>
                        </div>
                    </div>
                `;
                
                lawyerSelection.appendChild(lawyerOption);
                
                // Add click event to select lawyer
                lawyerOption.addEventListener('click', () => {
                    selectLawyer(lawyer, lawyerOption);
                });
            });
        }

        // Display available time slots
        function displayTimeSlots() {
            timeSlots.innerHTML = '';
            
            availableTimeSlots.forEach(time => {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.textContent = time;
                timeSlot.setAttribute('data-time', time);
                
                // Randomly mark some slots as unavailable for demo
                if (Math.random() < 0.3) {
                    timeSlot.classList.add('unavailable');
                }
                
                timeSlots.appendChild(timeSlot);
                
                // Add click event to select time slot
                timeSlot.addEventListener('click', () => {
                    if (!timeSlot.classList.contains('unavailable')) {
                        selectTimeSlot(time, timeSlot);
                    }
                });
            });
        }

        // Select a lawyer
        function selectLawyer(lawyer, element) {
            // Remove selected class from all lawyer options
            document.querySelectorAll('.lawyer-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            element.classList.add('selected');
            
            // Store selected lawyer
            selectedLawyer = lawyer;
            
            // Update summary
            updateSummary();
        }

        // Select a time slot
        function selectTimeSlot(time, element) {
            // Remove selected class from all time slots
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Add selected class to clicked slot
            element.classList.add('selected');
            
            // Store selected time
            selectedTime = time;
            
            // Update summary
            updateSummary();
        }

        // Select consultation mode
        function selectMode(mode, element) {
            // Remove selected class from all mode options
            document.querySelectorAll('.mode-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            element.classList.add('selected');
            
            // Store selected mode
            selectedMode = mode;
            consultationMode.value = mode;
            
            // Update summary
            updateSummary();
        }

        // Update booking summary
        function updateSummary() {
            // Update lawyer
            if (selectedLawyer) {
                summaryLawyer.textContent = selectedLawyer.users.full_name;
            } else {
                summaryLawyer.textContent = 'Not selected';
            }
            
            // Update date
            if (selectedDate) {
                const dateObj = new Date(selectedDate);
                summaryDate.textContent = dateObj.toLocaleDateString('en-IN', {
                    weekday: 'short',
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });
            } else {
                summaryDate.textContent = 'Not selected';
            }
            
            // Update time
            if (selectedTime) {
                summaryTime.textContent = selectedTime;
            } else {
                summaryTime.textContent = 'Not selected';
            }
            
            // Update mode
            if (selectedMode) {
                summaryMode.textContent = selectedMode === 'chat' ? 'Chat' : 'Video Call';
            } else {
                summaryMode.textContent = 'Not selected';
            }
            
            // Update price
            if (selectedLawyer && selectedMode) {
                const price = selectedMode === 'chat' 
                    ? selectedLawyer.consultation_fee_chat || consultationPrices.chat
                    : selectedLawyer.consultation_fee_video || consultationPrices.video;
                
                summaryPrice.textContent = `₹ ${price}`;
            } else {
                summaryPrice.textContent = '₹ 0';
            }
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Date change event
            consultationDate.addEventListener('change', (e) => {
                selectedDate = e.target.value;
                updateSummary();
                
                // Display time slots for the selected date
                displayTimeSlots();
            });
            
            // Mode selection events
            document.querySelectorAll('.mode-option').forEach(option => {
                option.addEventListener('click', () => {
                    const mode = option.getAttribute('data-mode');
                    selectMode(mode, option);
                });
            });
            
            // Form submission
            bookingForm.addEventListener('submit', handleBookingSubmission);
        }

        // Handle booking form submission
        async function handleBookingSubmission(e) {
            e.preventDefault();
            
            // Hide any previous messages
            hideMessages();
            
            // Validate form
            if (!selectedLawyer || !selectedDate || !selectedTime || !selectedMode) {
                showError('Please fill in all required fields to book your consultation.');
                return;
            }
            
            // Show loading spinner
            loadingSpinner.style.display = 'block';
            
            try {
                // Create date-time object
                const [time, modifier] = selectedTime.split(' ');
                let [hours, minutes] = time.split(':');
                
                if (modifier === 'PM' && hours !== '12') {
                    hours = parseInt(hours, 10) + 12;
                }
                if (modifier === 'AM' && hours === '12') {
                    hours = '00';
                }
                
                const dateTimeString = `${selectedDate}T${hours}:${minutes}:00`;
                const dateTime = new Date(dateTimeString);
                
                // Calculate consultation fee
                const consultationFee = selectedMode === 'chat' 
                    ? selectedLawyer.consultation_fee_chat || consultationPrices.chat
                    : selectedLawyer.consultation_fee_video || consultationPrices.video;
                
                // Save consultation to database
                const { data, error } = await supabase
                    .from('consultations')
                    .insert([
                        {
                            citizen_id: currentUser.id,
                            lawyer_id: selectedLawyer.id,
                            date_time: dateTime.toISOString(),
                            mode: selectedMode,
                            status: 'pending',
                            issue_description: issueDescription.value || null
                        }
                    ]);
                
                if (error) {
                    throw error;
                }
                
                // Hide loading spinner
                loadingSpinner.style.display = 'none';
                
                // Show success message
                showSuccess(`Consultation booked successfully with ${selectedLawyer.users.full_name}! You will receive a confirmation email shortly.`);
                
                // Reset form
                resetForm();
                
            } catch (error) {
                console.error('Error booking consultation:', error);
                loadingSpinner.style.display = 'none';
                showError('Failed to book consultation. Please try again.');
            }
        }

        // Reset form after successful booking
        function resetForm() {
            // Reset selected values
            selectedLawyer = null;
            selectedDate = null;
            selectedTime = null;
            selectedMode = null;
            
            // Reset UI
            document.querySelectorAll('.lawyer-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            document.querySelectorAll('.mode-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            consultationDate.value = '';
            consultationMode.value = '';
            issueDescription.value = '';
            timeSlots.innerHTML = '';
            
            // Reset summary
            updateSummary();
        }

        // Show success message
        function showSuccess(message) {
            successText.textContent = message;
            successMessage.style.display = 'block';
            
            // Scroll to top to show message
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show error message
        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.display = 'block';
            
            // Scroll to top to show message
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Hide all messages
        function hideMessages() {
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
        }

        // Event Listeners
        logoutBtn.addEventListener('click', async () => {
            const { error } = await supabase.auth.signOut();
            if (!error) {
                window.location.href = 'index.html';
            }
        });

        // Initialize the booking page when page loads
        document.addEventListener('DOMContentLoaded', initializeBooking);
    </script>
</body>
</html>